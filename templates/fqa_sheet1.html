<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FQA 청소 Check Sheet</title>
    <link rel="stylesheet" href="/static/fqa1.css">
</head>
<body>

    <!-- 홈 버튼 -->
    <div class="home-button-container">
        <button class="home-button" onclick="goHome()">Home</button>
    </div>
    <div class="container">
        <div class="info-section">
            <p><strong>Year:</strong> {{ year }}</p>
            <p><strong>Month:</strong> {{ month }}</p>
            <p><strong>Team:</strong> {{ team }}</p>
            <p><strong>Worker:</strong> {{ worker }}</p>
            <p><strong>Manager:</strong> {{ manager }}</p>
        </div>

        <div class="table-section">
            <div class="title">FQA 청소 Check Sheet</div>

            <!-- 표 구성 -->
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>청소 항목</th>
                        <th>청소 방법</th>
                        <th>관리 기준</th>
                        <th>확인 방법</th>
                        <th>청소 주기</th>
                        <th>확인</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>작업 테이블</td>
                        <td>알코올+무진천 사용</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>2회/Shift<br>1차:8시 20시<br>2차:14시 2시</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="1"></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>제품 구분 다이</td>
                        <td>알코올+무진천 사용</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="2"></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>현미경</td>
                        <td>알코올+무진천 사용</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="3"></td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>확대경</td>
                        <td>알코올+무진천 사용</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="4"></td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>공구 현미경</td>
                        <td>알코올+무진천 사용</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="5"></td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>바닥 청소 이물 제거</td>
                        <td>무진천을 사용하여 바닥 이물 제거</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="6"></td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>치공구 (수성펜, Scribing, Brush, Picker pen)</td>
                        <td>Airgun 후 알코올 무진천</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="7"></td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td>Brush 고무 cover</td>
                        <td>알코올, 무진천 사용하여 닦아낸다.</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="8"></td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td>부자재 보관함 청소</td>
                        <td>알코올, 무진천 사용하여 닦아낸다.</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="9"></td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>Suction Pad 청소</td>
                        <td>무진천을 사용하여 이물 제거</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="10"></td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>Brush 교체</td>
                        <td>파손 시 즉시 교체</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/3개월</td>
                        <td>
                            <input type="hidden" class="toggle-button" data-id="11" value="0">
                            <button class="confirm-button" onclick="confirmChange('brush', 11)">교체 여부</button>
                        </td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td>검사 불소 Pad 교체</td>
                        <td>파손 시 즉시 교체</td>
                        <td>이물 없을 것</td>
                        <td>육안</td>
                        <td>1회/1년</td>
                        <td>
                            <input type="hidden" class="toggle-button" data-id="12" value="0">
                            <button class="confirm-button" onclick="confirmChange('pad', 12)">교체 여부</button>
                        </td>
                    </tr>
                    
                    <tr>
                        <td>13</td>
                        <td>검사 Jig 점검</td>
                        <td>파손, 오염 갈라짐 확인</td>
                        <td>파손, 오염 시 즉시 교체</td>
                        <td>육안</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="13"></td>
                    </tr>
                </tbody>
            </table>

            <div class="form-group button-group">
                <button onclick="selectAll()">모두 O 선택</button>
                <button onclick="submitData()">체크 완료</button>
            </div>
            
            <!-- 홈 버튼 아래에 뒤로가기 버튼 추가 -->
            <div class="back-button-container">
                <button class="back-button" onclick="goBack()">Back</button>
            </div>
            <!-- 다음 시트 버튼 -->
            <div class="form-group next-sheet-button">
                <button onclick="goToNextSheet()">다음 시트</button>
            </div>

        </div>
    </div>

    <script>
        // 뒤로 가기 함수
        function goBack() {
            window.history.back(); // 이전 페이지로 이동
        }

        // 홈으로 이동하는 함수
        function goHome() {
            window.location.href = "/"; // 첫 라우터로 이동
        }
        // 다음 시트로 이동하는 함수
        function goToNextSheet() {
            const currentUrl = window.location.href;
            const nextSheetUrl = currentUrl.replace("sheet1", "sheet2");
            window.location.href = nextSheetUrl;
        }

        // 모두 O 선택 버튼 기능
        function selectAll() {
            const checkboxes = document.querySelectorAll('.toggle-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
        }

        // 교체 여부 버튼 클릭 시 재확인 창 띄우기
        function confirmChange(item, id) {  // id를 추가
            const confirmed = confirm(`Are you sure you want to confirm the replacement of the ${item}?`);
            if (confirmed) {
                alert('Replacement confirmed');
                document.querySelector(`input.toggle-button[data-id="${id}"]`).value = "1";
            } else {
                alert('Replacement canceled');
            }
        }

        // 데이터 수집 및 서버로 전송
        function submitData() {
            if (confirm("정말로 체크 완료하시겠습니까?")) {
                const checkboxes = document.querySelectorAll('.toggle-checkbox');
                const toggleButtons = document.querySelectorAll('.toggle-button');
                const data = {
                    team: "{{ team }}",
                    worker: "{{ worker }}",
                    manager: "{{ manager }}",
                    date: new Date().toISOString().slice(0, 10).replace(/-/g, "").slice(2), // yymmdd 형식 날짜
                    checks: []
                };
            
                checkboxes.forEach(checkbox => {
                    data.checks.push({
                        id: checkbox.dataset.id,
                        checked: checkbox.checked ? 1 : 0
                    });
                });

                toggleButtons.forEach(button => {
                    data.checks.push({
                        id: button.dataset.id,
                        checked: button.value
                    });
                });
            
                fetch('/save/sheet1', {  // '/save/sheet1' 경로로 POST 요청
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                    alert(result.message);
                    goToNextSheet();  // 데이터 전송 후 다음 시트로 이동
                })
                .catch(error => {
                    console.error('Error:', error);
                });      
            }
        }
    </script>
</body>
</html>
