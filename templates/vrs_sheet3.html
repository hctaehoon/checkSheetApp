<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRS 청소 Check Sheet 3</title>
    <link rel="stylesheet" href="/static/fqa1.css">
</head>
<body>

    <div class="container">
        <div class="info-section">
            <p><strong>Year:</strong> {{ year }}</p>
            <p><strong>Month:</strong> {{ month }}</p>
            <p><strong>Team:</strong> {{ team }}</p>
            <p><strong>Worker:</strong> {{ worker }}</p>
            <p><strong>Manager:</strong> {{ manager }}</p>
            <p><strong>Equipment ID:</strong> {{ equipment_id }}</p>
        </div>

        <div class="table-section">
            <div class="title">VRS PM 검증 </div>

            <!-- 표 구성 -->
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>청소 항목</th>
                        <th>청소 방법</th>
                        <th>관리 기준 및 확인 방법</th>
                        <th>청소 주기</th>
                        <th>확인</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>설비 외관 (자바라 포함) PM 검증</td>
                        <td>육안으로 확인하여 이물 확인한다</td>
                        <td>1차 검사 : 육안 (작업자)</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="1"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>무진천+알코올 사용하여 이물, 오염 여부 확인한다</td>
                        <td>2차 검사 : 무진천 + 알코올 (관리자)</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>작업 대기 선반 PM 검증</td>
                        <td>육안으로 확인하여 이물 확인한다</td>
                        <td>1차 검사 : 육안 (작업자)</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="2"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>무진천+알코올 사용하여 이물, 오염 여부 확인한다</td>
                        <td>2차 검사 : 무진천 + 알코올 (관리자)</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>설비 조작부 PM 검증</td>
                        <td>육안으로 확인하여 이물 확인한다</td>
                        <td>1차 검사 : 육안 (작업자)</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="3"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>무진천+알코올 사용하여 이물, 오염 여부 확인한다</td>
                        <td>2차 검사 : 무진천 + 알코올 (관리자)</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>부자재 보관함 PM 검증</td>
                        <td>육안으로 확인하여 이물 확인한다</td>
                        <td>1차 검사 : 육안 (작업자)</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="4"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>무진천+알코올 사용하여 이물, 오염 여부 확인한다</td>
                        <td>2차 검사 : 무진천 + 알코올 (관리자)</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>치공구 (수성펜, 스크러빙펜, 브러쉬) PM 검증</td>
                        <td>육안으로 확인하여 이물 확인한다</td>
                        <td>1차 검사 : 육안 (작업자)</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="5"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>무진천+알코올 사용하여 이물, 오염 여부 확인한다</td>
                        <td>2차 검사 : 무진천 + 알코올 (관리자)</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>Brush 고무 cover PM 검증</td>
                        <td>육안으로 확인하여 이물 확인한다</td>
                        <td>1차 검사 : 육안 (작업자)</td>
                        <td>1회/Shift</td>
                        <td><input type="checkbox" class="toggle-checkbox" data-id="6"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>무진천+알코올 사용하여 이물, 오염 여부 확인한다</td>
                        <td>2차 검사 : 무진천 + 알코올 (관리자)</td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>

            <div class="form-group button-group">
                <button onclick="selectAll()">모든 항목 점검</button>
                <button onclick="submitData()">체크 완료</button>
            </div>
            
            <div class="back-button-container">
                <button class="back-button" onclick="goBack()">Back</button>
            </div>

        </div>
    </div>

    <script>
        function goBack() {
            window.history.back(); // 이전 페이지로 이동
        }

        function selectAll() {
            const checkboxes = document.querySelectorAll('.toggle-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
        }

        function submitData() {
            const checkboxes = document.querySelectorAll('.toggle-checkbox');
            const unchecked = Array.from(checkboxes).some(checkbox => !checkbox.checked);

            // 모든 체크박스가 체크되었는지 확인
            if (unchecked) {
                alert("모든 체크 항목을 완료해 주세요.");
                return; // 체크되지 않은 항목이 있으면 함수 종료
            }

            if (confirm("정말로 체크 완료하시겠습니까?")) {
                const checkboxes = document.querySelectorAll('.toggle-checkbox');
                const data = {
                    team: "{{ team }}",
                    worker: "{{ worker }}",
                    manager: "{{ manager }}",
                    equipment_id: "{{ equipment_id }}",
                    date: new Date().toISOString().slice(0, 10).replace(/-/g, "").slice(2),
                    checks: []
                };

                checkboxes.forEach(checkbox => {
                    data.checks.push({
                        id: checkbox.dataset.id,
                        checked: checkbox.checked ? 1 : 0
                    });
                });

                fetch('/save/vrs_sheet3', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('네트워크 응답이 성공적이지 않습니다.');
                    }
                    return response.json();
                })
                .then(result => {
                    alert(result.message);
                    window.location.href = "/vrs";  // /vrs로 돌아가기
                })
                .catch(error => {
                    alert('데이터 저장에 실패했습니다. 다시 시도해주세요.');
                    console.error('Error:', error);
                });
            }
        }
    </script>
</body>
</html>
